<!DOCTYPE html>
<html>
	<head>
		<title>TODO supply a title</title>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
	</head>
	<body>
		
		<script src='assets/js/fretted.js'></script>
		<script src='assets/js/musicology.js'></script>
		<script src='assets/js/voicings.js'></script>
		<script>
			var notes = Musicology.getChord("C", "minor");
			var v = new Voicings().setInstrument(6, 24, ["E","B","G","D","A","E"]);
			var fb = v.getFretboard();
			v.setChord(notes);
			var voicings = v.getAllVoicings(5).splice(0,12);
			voicings.forEach(chord=>{
				
				var strings = [], s, i, pos=[];
				for(i=0; i<chord.length; i++){
					if(chord[i]=='x'){
						pos.push("x");
						strings.push(new Fretted.String().mute());
					}else{
						pos.push(fb[i][chord[i]]);
						strings.push(new Fretted.String().setFret(chord[i]).setNote(fb[i][chord[i]]));
					}
				}
				
				Fretted.Guitar().makeChord(strings).render(Fretted.IMAGE).then(img=>{
					var div = document.createElement("div");
					div.setAttribute("style", "border:1px solid black;");
					var r = fingerCount(chord);
					div.innerHTML = "<div>"+chord.join(", ")+"</div><div>"+r+"</div>";
					div.appendChild(img);
					document.body.appendChild(div);
				});
				
			});
			
			function fingerCount(pos){
				var fingers = 0;
				var frets = [];
				for(var i=0; i<Math.max(...(pos.filter(i=>i!="x"))); i++) frets.push([]);
				for(var i=0; i<pos.length; i++){
					if(pos[i]==="x"||pos[i]===0) continue;
					frets[pos[i]-1].push(i);
				}
				for(var i=0; i<frets.length; i++){
					if(!frets[i].length) continue;
					if(!frets[i].length == 1){
						fingers++;
						continue;
					}
					frets[i].sort().reverse();
					for(var string=0; string<frets[i].length; string++){
						var canBarre = true;
						for(var s=frets[i][string]; s--;){
							if(pos[s]=='x'||pos[s]<i){
								canBarre = false;
								continue;
							}
						}
						fingers++;
						if(canBarre) break;
					}
				}
				return fingers;
			}
		</script>
	</body>
</html>
